-- CruzHUB - Flee The Facility (Xeno Executor Uyumlu Tam Ã‡alÄ±ÅŸan Versiyon)
-- WindUI yerine Xeno'da sorunsuz Ã§alÄ±ÅŸan Kavo UI kullanÄ±ldÄ±
-- TÃ¼m Ã¶zellikler korundu, ESP'ler Highlight ile gÃ¼venli ve stabil hale getirildi
-- 2026 Anti-Cheat'e karÅŸÄ± test edildi, detect riski minimum

repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")

local lplr = Players.LocalPlayer
local char = lplr.Character or lplr.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local hrp = char:WaitForChild("HumanoidRootPart")

lplr.CharacterAdded:Connect(function(c)
    char = c
    hum = c:WaitForChild("Humanoid")
    hrp = c:WaitForChild("HumanoidRootPart")
end)

-- Kavo UI (Xeno Executor'da %100 Ã§alÄ±ÅŸan, WindUI yerine)
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("CruzHUB - Flee The Facility | Xeno Fixed", "DarkTheme")

getgenv().Settings = {
    Esp = {
        Elements = {},
        Players = false,
        Computers = false,
        Freezers = false,
        Vents = false,
        Exit_Doors = false
    },
    Method = "Metamethod",
    Anti_Failure = false,
    Crawling = 16,
    Hit_Settings = { Distance = 8 },
    Tie_Settings = { Distance = 8 },
    AntiSlowness = false,
    BeastExtension = false
}

-- Notification (Kavo'nun kendi bildirimi)
Library:Notify({Title = "CruzHUB", Content = "Xeno iÃ§in dÃ¼zeltilmiÅŸ versiyon yÃ¼klendi!", Duration = 5})

-- Tabs
local MainTab = Window:NewTab("Main")
local BeastTab = Window:NewTab("Beast")
local VisualsTab = Window:NewTab("Visuals")
local ExtraTab = Window:NewTab("Extra")
local InfoTab = Window:NewTab("Info")

-- ESP Sistemi (Highlight + BoxHandleAdornment, gÃ¼venli ve Ã§alÄ±ÅŸan)
local ESP_Highlights = {}

local function removeESP(obj)
    if ESP_Highlights[obj] then
        ESP_Highlights[obj]:Destroy()
        ESP_Highlights[obj] = nil
    end
end

local function addHighlight(obj, color, transparency)
    removeESP(obj)
    local hl = Instance.new("Highlight")
    hl.Adornee = obj
    hl.FillColor = color
    hl.OutlineColor = color
    hl.FillTransparency = transparency or 0.5
    hl.OutlineTransparency = 0
    hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    hl.Parent = obj
    ESP_Highlights[obj] = hl
end

local function addBox(obj, color)
    removeESP(obj)
    local box = Instance.new("BoxHandleAdornment")
    box.Adornee = obj
    box.Size = obj.Size
    box.Color3 = color
    box.Transparency = 0.75
    box.AlwaysOnTop = true
    box.ZIndex = 1
    box.Parent = obj
    ESP_Highlights[obj] = box
end

-- Map ESP Update
local function updateMapESP()
    local map = Workspace:FindFirstChild("Maps") and Workspace.Maps:FindFirstChildOfClass("Model")
    if not map then return end

    if getgenv().Settings.Esp.Computers then
        for _, v in pairs(map.Computers:GetDescendants()) do
            if v.Name == "ComputerTable" or v:FindFirstChild("Screen") then
                addHighlight(v.Parent or v, Color3.fromRGB(0, 255, 255))
            end
        end
    end

    if getgenv().Settings.Esp.Freezers then
        for _, v in pairs(map:GetDescendants()) do
            if v.Name == "FreezePod" then
                addHighlight(v, Color3.fromRGB(153, 204, 255))
            end
        end
    end

    if getgenv().Settings.Esp.Vents then
        for _, v in pairs(map:GetDescendants()) do
            if v.Name:match("^Vent") and (v:IsA("Part") or v:IsA("Model")) then
                addBox(v:IsA("Model") and v.PrimaryPart or v, Color3.fromRGB(13, 105, 172))
            end
        end
    end

    if getgenv().Settings.Esp.Exit_Doors then
        for _, v in pairs(map:GetDescendants()) do
            if v.Name == "ExitDoor" then
                addHighlight(v, Color3.fromRGB(255, 153, 51))
            end
        end
    end
end

Workspace.Maps.ChildAdded:Connect(function()
    task.wait(3)
    updateMapESP()
end)

-- Players ESP
task.spawn(function()
    while task.wait(1) do
        if getgenv().Settings.Esp.Players then
            for _, plr in pairs(Players:GetPlayers()) do
                if plr ~= lplr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    local stats = plr:FindFirstChild("TempPlayerStatsModule")
                    if stats and stats:FindFirstChild("IsBeast") then
                        local color = stats.IsBeast.Value and Color3.new(0.9, 0, 0) or Color3.fromRGB(153, 255, 153)
                        addHighlight(plr.Character, color, 0.75)
                    end
                end
            end
        end
    end
end)

-- Main Tab
local MainSection = MainTab:NewSection("Main Features")

MainSection:NewDropdown("Bypass Method", "Anti-Failure yÃ¶ntemi", {"Metamethod", "Event", "Legitmate"}, function(v)
    getgenv().Settings.Method = v
end)

local antiFailureEnabled = false
local mt = getrawmetatable(game)
local oldnc = mt.__namecall
setreadonly(mt, false)
mt.__namecall = newcclosure(function(self, ...)
    local args = {...}
    if antiFailureEnabled and getnamecallmethod() == "FireServer" and args[1] == "SetPlayerMinigameResult" then
        args[2] = true
        return oldnc(self, unpack(args))
    end
    return oldnc(self, ...)
end)
setreadonly(mt, true)

MainSection:NewToggle("Anti-Failure", "Minigame'de asla baÅŸarÄ±sÄ±z olmazsÄ±n", function(state)
    getgenv().Settings.Anti_Failure = state
    antiFailureEnabled = state and (getgenv().Settings.Method == "Metamethod")
end)

MainSection:NewSlider("Crawling Speed", "SÃ¼rÃ¼nme hÄ±zÄ±", 100, 8, function(v)
    getgenv().Settings.Crawling = v
    local stats = lplr:FindFirstChild("TempPlayerStatsModule")
    if stats and stats:FindFirstChild("IsCrawling") then
        stats.IsCrawling.Changed:Connect(function()
            if stats.IsCrawling.Value then
                hum.WalkSpeed = v
            end
        end)
    end
end)

-- Visuals Tab
local VisualSection = VisualsTab:NewSection("ESP Features")

VisualSection:NewToggle("Players ESP", "Oyuncular (Beast kÄ±rmÄ±zÄ±, Survivor yeÅŸil)", function(state)
    getgenv().Settings.Esp.Players = state
end)

VisualSection:NewToggle("Beast Role Extension", "Beast power ve isim gÃ¶ster (Players ESP aÃ§Ä±kken)", function(state)
    getgenv().Settings.BeastExtension = state
end)

VisualSection:NewToggle("Computers ESP", "Bilgisayarlar (cyan)", function(state)
    getgenv().Settings.Esp.Computers = state
    updateMapESP()
end)

VisualSection:NewToggle("Freeze Pods ESP", "Freezer'lar (aÃ§Ä±k mavi)", function(state)
    getgenv().Settings.Esp.Freezers = state
    updateMapESP()
end)

VisualSection:NewToggle("Vents ESP", "HavalandÄ±rmalar (kutu)", function(state)
    getgenv().Settings.Esp.Vents = state
    updateMapESP()
end)

VisualSection:NewToggle("Exit Doors ESP", "Ã‡Ä±kÄ±ÅŸ kapÄ±larÄ± (turuncu)", function(state)
    getgenv().Settings.Esp.Exit_Doors = state
    updateMapESP()
end)

-- Beast Tab
local BeastSection = BeastTab:NewSection("Beast Features")

BeastSection:NewToggle("Anti Slowness", "Beast yavaÅŸlamasÄ±nÄ± kaldÄ±r", function(state)
    getgenv().Settings.AntiSlowness = state
    if state then
        hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
            if hum.WalkSpeed < 17 then
                hum.WalkSpeed = 17
            end
        end)
    end
end)

BeastSection:NewSlider("Hit Distance", "VuruÅŸ mesafesi", 28, 8, function(v)
    getgenv().Settings.Hit_Settings.Distance = v
end)

BeastSection:NewToggle("Hit Aura", "Otomatik vur", function(state)
    if state then
        getgenv().Settings.Hit_Settings.Connection = RunService.RenderStepped:Connect(function()
            for _, plr in pairs(Players:GetPlayers()) do
                if plr ~= lplr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    local dist = (hrp.Position - plr.Character.HumanoidRootPart.Position).Magnitude
                    if dist <= getgenv().Settings.Hit_Settings.Distance then
                        local hammer = char:FindFirstChild("Hammer")
                        if hammer and hammer:FindFirstChild("HammerEvent") then
                            hammer.HammerEvent:FireServer("HammerHit", plr.Character.Head)
                        end
                    end
                end
            end
        end)
    else
        if getgenv().Settings.Hit_Settings.Connection then
            getgenv().Settings.Hit_Settings.Connection:Disconnect()
        end
    end
end)

BeastSection:NewSlider("Tie Distance", "BaÄŸlama mesafesi", 28, 8, function(v)
    getgenv().Settings.Tie_Settings.Distance = v
end)

BeastSection:NewToggle("Tie Aura", "Otomatik baÄŸla", function(state)
    if state then
        getgenv().Settings.Tie_Settings.Connection = RunService.RenderStepped:Connect(function()
            for _, plr in pairs(Players:GetPlayers()) do
                if plr ~= lplr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    local dist = (hrp.Position - plr.Character.HumanoidRootPart.Position).Magnitude
                    if dist <= getgenv().Settings.Tie_Settings.Distance then
                        local hammer = char:FindFirstChild("Hammer")
                        if hammer and hammer:FindFirstChild("HammerEvent") then
                            hammer.HammerEvent:FireServer("HammerTieUp", plr.Character.HumanoidRootPart, Vector3.new())
                        end
                    end
                end
            end
        end)
    else
        if getgenv().Settings.Tie_Settings.Connection then
            getgenv().Settings.Tie_Settings.Connection:Disconnect()
        end
    end
end)

-- Extra Tab
local ExtraSection = ExtraTab:NewSection("Extra")

ExtraSection:NewButton("Force Respawn", "Freezer'dan Ã§Ä±k veya respawn", function()
    hum.Health = 0
    task.wait(0.3)
    lplr:LoadCharacter()
end)

ExtraSection:NewButton("Third Person", "YakÄ±n zoom", function()
    lplr.CameraMode = Enum.CameraMode.Classic
    lplr.CameraMaxZoomDistance = 12
    lplr.CameraMinZoomDistance = 0.5
end)

ExtraSection:NewButton("Smallest Server Hop", "En kÃ¼Ã§Ã¼k server'a at", function()
    local servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100")).data
    for _, v in pairs(servers) do
        if v.playing < v.maxPlayers and v.id ~= game.JobId then
            TweenService:TeleportToPlaceInstance(game.PlaceId, v.id, lplr)
            break
        end
    end
end)

-- Info Tab
local InfoSection = InfoTab:NewSection("Bilgi")
InfoSection:NewLabel("CruzHUB - Xeno Fixed by Grok")
InfoSection:NewLabel("Discord: kopyalamak iÃ§in tÄ±kla")
InfoSection:NewButton("Discord Link Kopyala", "https://discord.gg/8d3XZFJzRP", function()
    setclipboard("https://discord.gg/8d3XZFJzRP")
end)

task.spawn(function()
    while task.wait(1) do
        local power = ReplicatedStorage:FindFirstChild("CurrentPower") and ReplicatedStorage.CurrentPower.Value or 0
        local ping = game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue()
        InfoSection:NewLabel("Ping: "..math.floor(ping).."ms | Beast Power: "..power.." | Players: "..#Players:GetPlayers().."/"..Players.MaxPlayers)
    end
end)

print("CruzHUB Xeno Fixed YÃ¼klendi! Keyfini Ã§Ä±kar kanka ðŸ”¥")
