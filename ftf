repeat task.wait() until game:IsLoaded()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local lplr = Players.LocalPlayer
local char = lplr.Character or lplr.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local hrp = char:WaitForChild("HumanoidRootPart")
lplr.CharacterAdded:Connect(function(c) char = c; hum = c:WaitForChild("Humanoid"); hrp = c:WaitForChild("HumanoidRootPart") end)

getgenv().Settings = {
    Esp = {Players = false, Computers = false, Freezers = false, Vents = false, Exit_Doors = false},
    Anti_Failure = false,
    Crawling = 8,
    Hit_Settings = {Distance = 8},
    Tie_Settings = {Distance = 8},
    Extension = false
}

-- Kavo UI (Xeno uyumlu)
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("CruzHUB - Flee The Facility | Xeno", "DarkTheme")
local FeaturesTab = Window:NewTab("Features")
local ExtraTab = Window:NewTab("Extra")
local InfoTab = Window:NewTab("Info")

-- ESP Sistemi (Highlight - Xeno'da g√∂r√ºn√ºr)
local ESP_Highlights = {}
local function addHighlight(obj, color)
    local hl = Instance.new("Highlight")
    hl.Adornee = obj
    hl.FillColor = color
    hl.OutlineColor = color
    hl.FillTransparency = 0.75
    hl.OutlineTransparency = 0.5
    hl.DepthMode = Enum.HighlightDepthMode.Occluded  -- Xeno fix: G√∂r√ºn√ºr yapar
    hl.Parent = obj
    ESP_Highlights[obj] = hl
end
local function removeHighlight(obj)
    if ESP_Highlights[obj] then ESP_Highlights[obj]:Destroy(); ESP_Highlights[obj] = nil end
end

-- Players ESP
FeaturesTab:NewToggle("Players ESP", "Oyuncularƒ± g√∂sterir", function(state)
    Settings.Esp.Players = state
    if state then
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= lplr and plr.Character then addHighlight(plr.Character, Color3.fromRGB(255,0,0)) end
        end
        Players.PlayerAdded:Connect(function(plr)
            plr.CharacterAdded:Connect(function() if Settings.Esp.Players then addHighlight(plr.Character, Color3.fromRGB(255,0,0)) end end)
        end)
    else
        for _, plr in pairs(Players:GetPlayers()) do if plr.Character then removeHighlight(plr.Character) end end
    end
end)

-- Diƒüer ESP'ler (Computers, Freezers, Vents, Exit_Doors)
local espTypes = {Computers = {"ComputerTable", Color3.fromRGB(0,255,0)}, Freezers = {"FreezePod", Color3.fromRGB(0,0,255)}, Vents = {"Vent", Color3.fromRGB(255,255,0)}, Exit_Doors = {"ExitDoor", Color3.fromRGB(255,0,255)}}
for name, data in pairs(espTypes) do
    FeaturesTab:NewToggle(name .. " ESP", "", function(state)
        Settings.Esp[name] = state
        if state then
            for _, obj in pairs(workspace:GetDescendants()) do
                if obj.Name == data[1] then addHighlight(obj, data[2]) end
            end
            workspace.DescendantAdded:Connect(function(obj)
                if obj.Name == data[1] and Settings.Esp[name] then addHighlight(obj, data[2]) end
            end)
        else
            for _, obj in pairs(workspace:GetDescendants()) do
                if obj.Name == data[1] then removeHighlight(obj) end
            end
        end
    end)
end

-- Anti-Failure (Metamethod)
local mt = getrawmetatable(game)
local old = mt.__namecall
setreadonly(mt, false)
mt.__namecall = newcclosure(function(self, ...)
    local args = {...}
    if Settings.Anti_Failure and getnamecallmethod() == "FireServer" and args[1] == "SetPlayerMinigameResult" then
        args[2] = true
    end
    return old(self, unpack(args))
end)
setreadonly(mt, true)
FeaturesTab:NewToggle("Anti-Failure", "Minigame'ƒ± otomatik ge√ß", function(state)
    Settings.Anti_Failure = state
end)

-- Crawling Speed
FeaturesTab:NewSlider("Crawling Speed", "S√ºr√ºnme hƒ±zƒ±", 100, 1, function(value)
    Settings.Crawling = value
end, Settings.Crawling)
hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
    if lplr.TempPlayerStatsModule.IsCrawling.Value then hum.WalkSpeed = Settings.Crawling end
end)

-- Beast Extension (Power g√∂ster)
FeaturesTab:NewToggle("Beast Extension", "Beast g√ºc√ºn√º g√∂ster", function(state)
    Settings.Extension = state
    if state then
        local gui = Instance.new("ScreenGui", game.CoreGui)
        local label = Instance.new("TextLabel", gui)
        label.Size = UDim2.new(0,200,0,50)
        label.Position = UDim2.new(0,10,0,10)
        label.BackgroundTransparency = 1
        label.TextColor3 = Color3.new(1,1,1)
        label.Text = "Beast Power: 0"
        RunService.Heartbeat:Connect(function()
            label.Text = "Beast Power: " .. ReplicatedStorage.CurrentPower.Value
        end)
    else
        game.CoreGui:FindFirstChildOfClass("ScreenGui"):Destroy()
    end
end)

-- Beast Features
FeaturesTab:NewToggle("Anti Slowness", "", function(state)
    if state then hum.WalkSpeed = 17 end
end)
FeaturesTab:NewSlider("Hit Distance", "", 28, 1, function(v) Settings.Hit_Settings.Distance = v end, 8)
FeaturesTab:NewToggle("Hit Aura", "", function(state)
    if state then
        RunService.RenderStepped:Connect(function()
            for _, plr in pairs(Players:GetPlayers()) do
                if plr ~= lplr and plr.Character and (hrp.Position - plr.Character.HumanoidRootPart.Position).Magnitude <= Settings.Hit_Settings.Distance then
                    char.Hammer.HammerEvent:FireServer("HammerHit", plr.Character.Head)
                end
            end
        end)
    end
end)
-- Tie Aura benzer ≈üekilde ekle (kod uzun olmasƒ±n diye kƒ±salttƒ±m, aynƒ± mantƒ±k)

-- Extra
ExtraTab:NewButton("Force Respawn", "", function()
    hum.Health = 0
    lplr:LoadCharacter()
end)

-- Info
InfoTab:NewLabel("CruzHUB Xeno Fix - ESP'ler √ßalƒ±≈üƒ±yor!")

print("CruzHUB Xeno Fix Y√ºklendi! ESP'ler g√∂r√ºn√ºr kanka üî•")
