repeat task.wait() until game:IsLoaded()
local lib = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
lib:Notify({Title = "CruzHUB Notification.",Content = "Loaded Successfully!",Duration = 3,Icon = "bird"})

local rep = game:GetService("ReplicatedStorage")
local runs = game:GetService("RunService")
local uis = game:GetService("UserInputService")
local rs = game:GetService("RunService")
local httpservice = game:GetService("HttpService")
local ts = game:GetService("TweenService")
local lplr = game:GetService("Players").LocalPlayer

local char = lplr.Character or lplr.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local hrp = char:WaitForChild("HumanoidRootPart")

lplr.CharacterAdded:Connect(function(c) 
    char = c
    hum = c:WaitForChild("Humanoid")
    hrp = c:WaitForChild("HumanoidRootPart") 
end)

getgenv().Settings = {
    Esp = {
        Elements = {},
        Players = false,
        Computers = false,
        Freezers = false,
        Vents = false,
        Exit_Doors = false
    },
    Method = "Metamethod",
    Anti_Failure = false,
    Crawling = 8,
    Hit_Settings = {
        Distance = 8,
        Connection = nil
    },
    Tie_Settings = {
        Distance = 8,
        Connection = nil
    }
}

local win = lib:CreateWindow({
    Title = "CruzHUB - FTF/Flee The Facility",
    Icon = "rbxassetid://140350520713166",
    Author = "Owner: leite",
    Size = UDim2.fromOffset(820,540),
    Transparent = true,
    Theme = "Dark",
    Resizable = true,
    SideBarWidth = 180,
    ScrollBarEnabled = true,
    User = {Enabled = true,Anonymous = false}
})

win:EditOpenButton({
    Title = "CruzHUB",
    Icon = "monitor",
    CornerRadius = UDim.new(0,6),
    StrokeThickness = 2,
    Color = ColorSequence.new(Color3.fromRGB(30,30,30),Color3.fromRGB(255,255,255)),
    Draggable = true
})

local Sections = {
    Main = win:Section({Title = "Main Section",Icon = "crown",Opened = false}),
    Misc = win:Section({Title = "Misc",Icon = "info",Opened = false})
}

local Tabs = {
    Features = Sections.Main:Tab({Title = "Features",Icon = "sword",Desc = "The Tab That Contains Everything Important."}),
    ExtraFeatures = Sections.Main:Tab({Title = "Extra Features",Icon = "lucide:anchor",Desc = "Oh My Gyat. More Features?"}),
    Info = Sections.Misc:Tab({Title = "Info",Icon = "users",Desc = "Credits And Discord Server And Information."})
}

Tabs.Features:Paragraph({Title = "Main Section",Color = "Orange",Locked = true})

Tabs.Features:Dropdown({
    Title = "Bypass Method",
    Values = {"Metamethod","Event","Legitmate"},
    Value = "Metamethod",
    Callback = function(v)
        getgenv().Settings.Method = v
    end
})

local enabled = false
local mt = getrawmetatable(game)
local old = mt.__namecall
setreadonly(mt, false)
mt.__namecall = newcclosure(function(self, ...)
    local args = {...}
    local method = getnamecallmethod()
    if enabled and method == "FireServer" and tostring(args[1]) == "SetPlayerMinigameResult" then
        args[2] = true
    end
    return old(self, unpack(args))
end)
setreadonly(mt, true)

Tabs.Features:Toggle({
    Title = "Anti-Failure",
    Desc = "Failure? That Never Existed.",
    Type = "Checkbox",
    Value = false,
    Callback = function(v)
        getgenv().Settings.Anti_Failure = v
        if getgenv().Settings.Method == "Metamethod" then
            enabled = getgenv().Settings.Anti_Failure
        elseif getgenv().Settings.Method == "Event" then
            if v then
                task.spawn(function()
                    while getgenv().Settings.Anti_Failure and getgenv().Settings.Method == "Event" do
                        pcall(function()
                            rep.RemoteEvent:FireServer("SetPlayerMinigameResult", true)
                        end)
                        task.wait()
                    end
                end)
            end
        end
    end
})

Tabs.Features:Paragraph({Title = "LocalPlayer Section",Color = "Orange",Locked = true})

Tabs.Features:Slider({
    Title = "Crawling Speed",
    Step = 1,
    Value = {Min = 8,Max = 100,Default = getgenv().Settings.Crawling},
    Callback = function(v)
        getgenv().Settings.Crawling = v
        task.spawn(function()
            local IsCrawling = lplr:FindFirstChild("TempPlayerStatsModule")
            if IsCrawling then
                IsCrawling = IsCrawling:FindFirstChild("IsCrawling")
                if IsCrawling then
                    IsCrawling:GetPropertyChangedSignal("Value"):Connect(function()
                        if IsCrawling.Value then
                            hum.WalkSpeed = getgenv().Settings.Crawling
                        end
                    end)
                end
            end
        end)
    end
})

Tabs.Features:Paragraph({Title = "Visuals Section",Color = "Orange",Locked = true})

local extension = false

local function cleanup(plr, Elements)
    local data = Elements["Players"][plr]
    if data then
        pcall(function()
            if data.conn then data.conn:Disconnect() end
            if data.hi then data.hi:Destroy() end
            if data.bbg then data.bbg:Destroy() end
        end)
        Elements["Players"][plr] = nil
    end
end

local function plr_esp(Elements)
    if not getgenv().Settings.Esp.Players then return end
    for _, plr in ipairs(game:GetService("Players"):GetPlayers()) do
        if plr ~= lplr and plr.Character then
            local stats = plr:FindFirstChild("TempPlayerStatsModule")
            if stats and stats:FindFirstChild("IsBeast") then
                cleanup(plr, Elements)
                local bbg, tl, hi
                pcall(function()
                    if extension then
                        bbg = Instance.new("BillboardGui")
                        bbg.Parent = plr.Character:FindFirstChild("Head")
                        bbg.Size = UDim2.fromOffset(100,50)
                        bbg.StudsOffset = Vector3.new(0,2,0)
                        bbg.AlwaysOnTop = true
                        bbg.Adornee = plr.Character:FindFirstChild("Head")
                        tl = Instance.new("TextLabel", bbg)
                        tl.Size = UDim2.fromScale(1,1)
                        tl.BackgroundTransparency = 1
                        tl.TextColor3 = stats.IsBeast.Value and Color3.new(.9,0,0) or Color3.fromRGB(153,255,153)
                        tl.Font = Enum.Font.Fantasy
                        tl.TextSize = 13
                        tl.Text = stats.IsBeast.Value and ("Power: "..tostring(rep:FindFirstChild("CurrentPower") and rep.CurrentPower.Value or 0).." | Beast | "..plr.Name) or ("Survivor | "..plr.Name)
                    end
                    
                    hi = Instance.new("Highlight")
                    hi.Parent = plr.Character
                    hi.FillColor = stats.IsBeast.Value and Color3.new(.9,0,0) or Color3.fromRGB(153,255,153)
                    hi.OutlineTransparency = stats.IsBeast.Value and .5 or 1
                    hi.FillTransparency = .75
                    hi.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                    
                    Elements["Players"][plr] = {
                        hi = hi,
                        bbg = bbg,
                        tl = tl,
                        conn = stats.IsBeast:GetPropertyChangedSignal("Value"):Connect(function()
                            if hi then
                                hi.FillColor = stats.IsBeast.Value and Color3.new(.9,0,0) or Color3.fromRGB(153,255,153)
                                hi.OutlineTransparency = stats.IsBeast.Value and .5 or 1
                            end
                            if tl then
                                tl.TextColor3 = stats.IsBeast.Value and Color3.new(.9,0,0) or Color3.fromRGB(153,255,153)
                                tl.Text = stats.IsBeast.Value and ("Power: "..tostring(rep:FindFirstChild("CurrentPower") and rep.CurrentPower.Value or 0).." | Beast | "..plr.Name) or ("Survivor | "..plr.Name)
                            end
                        end)
                    }
                end)
            end
        end
    end
end

Tabs.Features:Toggle({
    Title = "Players Esp",
    Desc = "",
    Type = "Checkbox",
    Default = false,
    Callback = function(state)
        getgenv().Settings.Esp.Players = state
        local Elements = getgenv().Settings.Esp.Elements
        Elements["Players"] = Elements["Players"] or {}
        
        if state then
            plr_esp(Elements)
            game:GetService("Players").PlayerAdded:Connect(function(plr)
                plr.CharacterAdded:Connect(function()
                    task.wait(1)
                    plr_esp(Elements)
                end)
            end)
        else
            for plr, data in pairs(Elements["Players"]) do
                cleanup(plr, Elements)
            end
            Elements["Players"] = {}
        end
    end
})

game:GetService("Players").PlayerRemoving:Connect(function(plr)
    local Elements = getgenv().Settings.Esp.Elements
    if Elements and Elements["Players"] then
        cleanup(plr, Elements)
    end
end)

Tabs.Features:Toggle({
    Title = "Beast Role Extension",
    Desc = "Make The Players Esp Apply A TextLabel To Identify The Beasts Power And Names",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        extension = state
        if getgenv().Settings.Esp.Players then
            local Elements = getgenv().Settings.Esp.Elements
            for plr, data in pairs(Elements["Players"]) do
                cleanup(plr, Elements)
            end
            plr_esp(Elements)
        end
    end
})

-- Simplified ESP functions for other objects (same pattern)
local function createGenericEspToggle(tab, title, settingKey, color, nameMatch)
    tab:Toggle({
        Title = title.." Esp",
        Desc = "",
        Type = "Checkbox",
        Value = false,
        Callback = function(state)
            getgenv().Settings.Esp[settingKey] = state
            local Elements = getgenv().Settings.Esp.Elements
            Elements[settingKey] = Elements[settingKey] or {}
            
            local function Apply(v)
                if v.Name:match(nameMatch) and not Elements[settingKey][v] then
                    pcall(function()
                        local hi = Instance.new("Highlight")
                        hi.Parent = v
                        hi.FillColor = color
                        hi.OutlineTransparency = 1
                        hi.FillTransparency = .75
                        hi.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                        Elements[settingKey][v] = hi
                    end)
                end
            end
            
            if state then
                for _, v in ipairs(workspace:GetDescendants()) do
                    Apply(v)
                end
                Elements[settingKey].Connection = workspace.DescendantAdded:Connect(Apply)
            else
                if Elements[settingKey].Connection then 
                    Elements[settingKey].Connection:Disconnect() 
                    Elements[settingKey].Connection = nil 
                end
                for i, v in pairs(Elements[settingKey]) do 
                    if v then v:Destroy() end 
                end
                Elements[settingKey] = {}
            end
        end
    })
end

createGenericEspToggle(Tabs.Features, "Computers", "Computers", Color3.fromRGB(255,255,255), "ComputerTable")
createGenericEspToggle(Tabs.Features, "FreezePods", "Freezers", Color3.fromRGB(153,204,255), "FreezePod")
createGenericEspToggle(Tabs.Features, "Vents", "Vents", Color3.fromRGB(13,105,172), "^Vent")
createGenericEspToggle(Tabs.Features, "ExitDoors", "Exit_Doors", Color3.fromRGB(255,153,51), "ExitDoor")

Tabs.Features:Paragraph({Title = "Beast Section",Color = "Red",Locked = true})

local antiSlownessConn
Tabs.Features:Toggle({
    Title = "Anti Slowness",
    Desc = "",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        if state then
            antiSlownessConn = hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
                pcall(function()
                    local IsCrawling = lplr:FindFirstChild("TempPlayerStatsModule") and lplr.TempPlayerStatsModule:FindFirstChild("IsCrawling")
                    if IsCrawling and not IsCrawling.Value and hum.WalkSpeed < 16 then
                        hum.WalkSpeed = 17
                    end
                end)
            end)
        elseif antiSlownessConn then
            antiSlownessConn:Disconnect()
            antiSlownessConn = nil
        end
    end
})

Tabs.Features:Slider({
    Title = "Hit Distance",
    Step = 1,
    Value = {Min = 8,Max = 28,Default = 8},
    Callback = function(v)
        getgenv().Settings.Hit_Settings.Distance = v
    end
})

Tabs.Features:Toggle({
    Title = "Hit Aura",
    Desc = "",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        if state and not getgenv().Settings.Hit_Settings.Connection then
            getgenv().Settings.Hit_Settings.Connection = runs.RenderStepped:Connect(function()
                for _, plr in ipairs(game:GetService("Players"):GetPlayers()) do
                    if plr ~= lplr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                        local thrp = plr.Character.HumanoidRootPart
                        local rag = plr.Character:FindFirstChild("Ragdoll")
                        if (hrp.Position - thrp.Position).Magnitude <= getgenv().Settings.Hit_Settings.Distance and not (rag and rag.Value) then
                            pcall(function()
                                if char:FindFirstChild("Hammer") and char.Hammer:FindFirstChild("HammerEvent") then
                                    char.Hammer.HammerEvent:FireServer("HammerHit", plr.Character.Head)
                                end
                            end)
                        end
                    end
                end
            end)
        elseif getgenv().Settings.Hit_Settings.Connection then
            getgenv().Settings.Hit_Settings.Connection:Disconnect()
            getgenv().Settings.Hit_Settings.Connection = nil
        end
    end
})

Tabs.Features:Slider({
    Title = "Tie Distance",
    Step = 1,
    Value = {Min = 8,Max = 28,Default = 8},
    Callback = function(v)
        getgenv().Settings.Tie_Settings.Distance = v
    end
})

Tabs.Features:Toggle({
    Title = "Tie Aura",
    Desc = "",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        if state and not getgenv().Settings.Tie_Settings.Connection then
            getgenv().Settings.Tie_Settings.Connection = runs.RenderStepped:Connect(function()
                for _, plr in ipairs(game:GetService("Players"):GetPlayers()) do
                    if plr ~= lplr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                        local thrp = plr.Character.HumanoidRootPart
                        local rag = plr.Character:FindFirstChild("Ragdoll")
                        if (hrp.Position - thrp.Position).Magnitude <= getgenv().Settings.Tie_Settings.Distance and not (rag and rag.Value) then
                            pcall(function()
                                if char:FindFirstChild("Hammer") and char.Hammer:FindFirstChild("HammerEvent") then
                                    char.Hammer.HammerEvent:FireServer("HammerTieUp", thrp, Vector3.new(0,0,0))
                                end
                            end)
                        end
                    end
                end
            end)
        elseif getgenv().Settings.Tie_Settings.Connection then
            getgenv().Settings.Tie_Settings.Connection:Disconnect()
            getgenv().Settings.Tie_Settings.Connection = nil
        end
    end
})

Tabs.ExtraFeatures:Button({
    Title = "ShiftLock",
    Desc = "This Is By Nameless Admin.",
    Locked = false,
    Callback = function()
        loadstring(game:HttpGet("https://github.com/ltseverydayyou/uuuuuuu/blob/main/shiftlock?raw=true"))()
    end
})

Tabs.ExtraFeatures:Button({
    Title = "Third Person",
    Desc = "Force Is Necessary...",
    Locked = false,
    Callback = function()
        lplr.CameraMode = Enum.CameraMode.Classic
        lplr.CameraMinZoomDistance = .5
        lplr.CameraMaxZoomDistance = 12
    end
})

Tabs.ExtraFeatures:Button({
    Title = "Force Respawn",
    Desc = "This Can Free You From A Freezer But If Everyone Is Frozen You'll Lose. Force Is Necessary.",
    Locked = false,
    Callback = function()
        hum.Health = 0
        lplr:LoadCharacter()
    end
})

local info = Tabs.Info:Paragraph({
    Title = "Info + More Features:",
    Desc = "",
    Color = "Green",
    Buttons = {
        {
            Icon = "bird",
            Title = "Discord Server Link",
            Callback = function() 
                setclipboard("https://discord.gg/8d3XZFJzRP") 
                lib:Notify({Title = "Discord Server Link.",Content = "https://discord.gg/8d3XZFJzRP",Duration = 8,Icon = "check"}) 
            end
        },
        {
            Title = "Smallest Serverhop",
            Callback = function() 
                task.spawn(function()
                    local success, result = pcall(function()
                        return httpservice:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"))
                    end)
                    if success and result and result.data and result.data[1] then
                        local JobId = result.data[1].id
                        if JobId ~= game.JobId then
                            ts:TeleportToPlaceInstance(game.PlaceId, JobId, lplr)
                        end
                    end
                end)
            end
        }
    },
    Locked = true
})

runs.Heartbeat:Connect(function()
    pcall(function()
        local currentPower = rep:FindFirstChild("CurrentPower") and rep.CurrentPower.Value or 0
        local playerCount = #game:GetService("Players"):GetPlayers()
        info:SetDesc("Credits To The Owner: leite\nDiscord Name For Contact: 86x1\nPing: "..math.floor(game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue() or 0).."ms.\nServer Stuff:\nSize: "..playerCount.."/"..game:GetService("Players").MaxPlayers..".\nBeast Power: "..currentPower)
    end)
end)

print("CruzHUB loaded successfully for Xeno Executor!")
