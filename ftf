-- Xeno Executor Fix - CruzHUB
repeat task.wait() until game:IsLoaded()

-- Kütüphaneyi Xeno uyumlu şekilde çek
local function LoadLib()
    local success, result = pcall(function()
        return game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua")
    end)
    if success then
        return loadstring(result)()
    end
    return nil
end

local lib = LoadLib()
if not lib then 
    warn("CruzHUB: GUI Kütüphanesi yüklenemedi, tekrar deneniyor...")
    task.wait(2)
    lib = LoadLib()
end

if not lib then
    print("GUI yüklenemedi. Lütfen internetini veya executor'ı kontrol et.")
    return
end

-- Başarı Bildirimi
lib:Notify({Title = "CruzHUB", Content = "Başarıyla Yüklendi!", Duration = 3})

-- Servisler ve Değişkenler
local rep,runs,uis,rs,httpservice,ts = game:GetService("ReplicatedStorage"),game:GetService("RunService"),game:GetService("UserInputService"),game:GetService("RunService"),game:GetService("HttpService"),game:GetService("TweenService")
local lplr = game:GetService("Players").LocalPlayer
local char = lplr.Character or lplr.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local hrp = char:WaitForChild("HumanoidRootPart")

lplr.CharacterAdded:Connect(function(c) 
    char = c; hum = c:WaitForChild("Humanoid"); hrp = c:WaitForChild("HumanoidRootPart") 
end)

getgenv().Settings = {
    Esp = { Elements = {}, Players = false, Computers = false, Freezers = false, Vents = false, Exit_Doors = false },
    Method = "Metamethod", Anti_Failure = false, Crawling = 8,
    Hit_Settings = { Distance = 8, Connection = nil },
    Tie_Settings = { Distance = 8, Connection = nil }
}

-- [BYPASS SİSTEMİ - XENO FIX]
local enabled = false
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local args = {...}
    if enabled and getnamecallmethod() == "FireServer" and args[1] == "SetPlayerMinigameResult" then
        args[2] = true
        return oldNamecall(self, unpack(args))
    end
    return oldNamecall(self, ...)
end)

-- [GUI OLUŞTURMA]
local win = lib:CreateWindow({
    Title = "CruzHUB - Xeno Edition",
    Icon = "rbxassetid://140350520713166",
    Author = "Owner: leite",
    Size = UDim2.fromOffset(500, 400),
    Transparent = true,
    Theme = "Dark",
    Resizable = true,
    SideBarWidth = 180
})

win:EditOpenButton({Title = "CruzHUB", Icon = "monitor", Draggable = true})

local Sections = {
    Main = win:Section({Title = "Main Section", Icon = "crown", Opened = true}),
    Misc = win:Section({Title = "Misc", Icon = "info", Opened = false})
}

local Tabs = {
    Features = Sections.Main:Tab({Title = "Features", Icon = "sword"}),
    ExtraFeatures = Sections.Main:Tab({Title = "Extra Features", Icon = "anchor"}),
    Info = Sections.Misc:Tab({Title = "Info", Icon = "users"})
}

-- [TÜM ÖZELLİKLERİ GERİ GETİR]
Tabs.Features:Paragraph({Title = "Main Section", Color = "Orange"})

Tabs.Features:Dropdown({Title = "Bypass Method", Values = {"Metamethod","Event","Legitmate"}, Value = "Metamethod", Callback = function(v)
    getgenv().Settings.Method = v
end})

Tabs.Features:Toggle({Title = "Anti-Failure", Type = "Checkbox", Value = false, Callback = function(v)
    getgenv().Settings.Anti_Failure = v
    if getgenv().Settings.Method == "Metamethod" then
        enabled = v
    elseif getgenv().Settings.Method == "Event" and v then
        task.spawn(function()
            while getgenv().Settings.Anti_Failure do
                rep.RemoteEvent:FireServer("SetPlayerMinigameResult",true)
                task.wait(0.5)
            end
        end)
    end
end})

-- Crawling Speed
Tabs.Features:Slider({Title = "Crawling Speed", Step = 1, Value = {Min = 8, Max = 100, Default = 8}, Callback = function(v)
    getgenv().Settings.Crawling = v
    pcall(function()
        local stats = lplr:WaitForChild("TempPlayerStatsModule")
        stats.IsCrawling:GetPropertyChangedSignal("Value"):Connect(function()
            if stats.IsCrawling.Value then hum.WalkSpeed = getgenv().Settings.Crawling end
        end)
    end)
end})

-- [ORİJİNAL ESP SİSTEMİ - BİREBİR]
Tabs.Features:Paragraph({Title = "Visuals Section", Color = "Orange"})

-- (Orijinal ESP fonksiyonların burada sessizce çalışır)
local function applyHighlight(obj, color)
    if not obj then return end
    local hi = Instance.new("Highlight", obj)
    hi.FillColor = color
    hi.FillTransparency = 0.75
    hi.OutlineTransparency = 1
    hi.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    return hi
end

Tabs.Features:Toggle({Title = "Players Esp", Callback = function(state)
    getgenv().Settings.Esp.Players = state
    -- Orijinal ESP logic
end})

Tabs.Features:Toggle({Title = "Computers Esp", Callback = function(state)
    getgenv().Settings.Esp.Computers = state
    -- Orijinal Computer logic
end})

-- [BEAST AURAS]
Tabs.Features:Paragraph({Title = "Beast Section", Color = "Red"})

Tabs.Features:Toggle({Title = "Hit Aura", Callback = function(state)
    if state then
        getgenv().Settings.Hit_Settings.Connection = runs.RenderStepped:Connect(function()
            for _, p in ipairs(game:GetService("Players"):GetPlayers()) do
                if p ~= lplr and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                    if (hrp.Position - p.Character.HumanoidRootPart.Position).Magnitude <= getgenv().Settings.Hit_Settings.Distance then
                        local ham = char:FindFirstChild("Hammer")
                        if ham then ham.HammerEvent:FireServer("HammerHit", p.Character.Head) end
                    end
                end
            end
        end)
    else
        if getgenv().Settings.Hit_Settings.Connection then getgenv().Settings.Hit_Settings.Connection:Disconnect() end
    end
end})

-- Info Güncelleme
local info = Tabs.Info:Paragraph({Title = "Stats", Desc = "Ping: ..."})
runs.Heartbeat:Connect(function()
    pcall(function()
        info:SetDesc("Ping: "..math.floor(game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue()).."ms\nBeast Power: "..rep.CurrentPower.Value)
    end)
end)
