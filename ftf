repeat task.wait() until game:IsLoaded()
local lib = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
lib:Notify({Title = "CruzHUB Notification.",Content = "Loaded Successfully!",Duration = 3,Icon = "bird"})
local rep,runs,uis,rs,httpservice,ts = game:GetService("ReplicatedStorage"),game:GetService("RunService"),game:GetService("UserInputService"),game:GetService("RunService"),game:GetService("HttpService"),game:GetService("TweenService")
local lplr = game:GetService("Players").LocalPlayer
local char = lplr.Character or lplr.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local hrp = char:WaitForChild("HumanoidRootPart")
lplr.CharacterAdded:Connect(function(c) char = c;hum = c:WaitForChild("Humanoid");hrp = c:WaitForChild("HumanoidRootPart") end)
getgenv().Settings = {
    Esp = {
        Elements = {},
        Players = false,
        Computers = false,
        Freezers = false,
        Vents = false,
        Exit_Doors = false
    },
    Method = "Metamethod",
    Anti_Failure = false,
    Crawling = 8,
    Hit_Settings = {
        Distance = 8,
        Connection = nil
    },
    Tie_Settings = {
        Distance = 8,
        Connection = nil
    }
}

-- XENO FIX: Metatable kısmı hookmetamethod ile değiştirildi (Çökme engellendi)
local enabled = false
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local args = {...}
    if enabled and getnamecallmethod() == "FireServer" and args[1] == "SetPlayerMinigameResult" then
        args[2] = true
        return oldNamecall(self, unpack(args))
    end
    return oldNamecall(self, unpack(args))
end)

local win = lib:CreateWindow({Title = "CruzHUB - FTF/Flee The Facility",Icon = "rbxassetid://140350520713166",Author = "Owner: leite",Size = UDim2.fromOffset(820,540),Transparent = true,Theme = "Dark",Resizable = true,SideBarWidth = 180,ScrollBarEnabled = true,User = {Enabled = true,Anonymous = false}})
win:EditOpenButton({Title = "CruzHUB",Icon = "monitor",CornerRadius = UDim.new(0,6),StrokeThickness = 2,Color = ColorSequence.new(Color3.fromRGB(30,30,30),Color3.fromRGB(255,255,255)),Draggable = true})
local Sections = {
    Main = win:Section({Title = "Main Section",Icon = "crown",Opened = true}),
    Misc = win:Section({Title = "Misc",Icon = "info",Opened = false})
}
local Tabs = {
    Features = Sections.Main:Tab({Title = "Features",Icon = "sword",Desc = "The Tab That Contains Everything Important."}),
    ExtraFeatures = Sections.Main:Tab({Title = "Extra Features",Icon = "lucide:anchor",Desc = "Oh My Gyat. More Features?"}),
    Info = Sections.Misc:Tab({Title = "Info",Icon = "users",Desc = "Credits And Discord Server And Information."})
}
Tabs.Features:Paragraph({Title = "Main Section",Color = "Orange",Locked = true})
Tabs.Features:Dropdown({Title = "Bypass Method",Values = {"Metamethod","Event","Legitmate"},Value = "Metamethod",Callback = function(v)
    getgenv().Settings.Method = v
end,})

Tabs.Features:Toggle({Title = "Anti-Failure",Desc = "Failure? That Never Existed.",Type = "Checkbox",Value = false,Callback = function(v)
    getgenv().Settings.Anti_Failure = v
    if getgenv().Settings.Method == "Metamethod" then
        enabled = getgenv().Settings.Anti_Failure
    elseif getgenv().Settings.Method == "Event" then
        if v then
            task.spawn(function()
                while getgenv().Settings.Anti_Failure and getgenv().Settings.Method == "Event" do
                    rep.RemoteEvent:FireServer("SetPlayerMinigameResult",true)
                    task.wait()
                end
            end)
        end
    end
end,})
Tabs.Features:Paragraph({Title = "LocalPlayer Section",Color = "Orange",Locked = true})
Tabs.Features:Slider({Title = "Crawling Speed",Step = 1,Value = {Min = 8,Max = 100,Default = tonumber(getgenv().Settings.Crawling)},Callback = function(v)
    getgenv().Settings.Crawling = v
    local IsCrawling = lplr and lplr:WaitForChild("TempPlayerStatsModule") and lplr.TempPlayerStatsModule:WaitForChild("IsCrawling") and lplr.TempPlayerStatsModule.IsCrawling
    IsCrawling:GetPropertyChangedSignal("Value"):Connect(function()
        if IsCrawling.Value then
            hum.WalkSpeed = getgenv().Settings.Crawling
        end
    end)
end,})
Tabs.Features:Paragraph({Title = "Visuals Section",Color = "Orange",Locked = true})
local extension = false
local function cleanup(plr,Elements)
    local data = Elements["Players"][plr]
    if data then
        if data.conn then data.conn:Disconnect() end
        if data.hi then data.hi:Destroy() end
        if data.bbg then data.bbg:Destroy() end
        Elements["Players"][plr] = nil
    end
end
local function plr_esp(Elements)
    if not getgenv().Settings.Esp.Players then return end
    for _,plr in ipairs(game:GetService("Players"):GetPlayers()) do
        if plr ~= game:GetService("Players").LocalPlayer and plr.Character then
            local stats = plr:FindFirstChild("TempPlayerStatsModule") or plr:WaitForChild("TempPlayerStatsModule")
            if not stats or not stats:FindFirstChild("IsBeast") then continue end
            cleanup(plr, Elements)
            local bbg, tl
            if extension then
                bbg = Instance.new("BillboardGui",plr.Character:WaitForChild("Head"))
                bbg.Size = UDim2.fromOffset(100,50)
                bbg.StudsOffset = Vector3.new(0,2,0)
                bbg.AlwaysOnTop = true
                bbg.Adornee = plr.Character:WaitForChild("Head")
                tl = Instance.new("TextLabel",bbg)
                tl.Size = UDim2.fromScale(1,1)
                tl.BackgroundTransparency = 1
                tl.TextColor3 = stats.IsBeast.Value and Color3.new(.9,0,0) or Color3.fromRGB(153,255,153)
                tl.Font = Enum.Font.Fantasy
                tl.TextSize = 13
                tl.Text = stats.IsBeast.Value and ("Power: "..rep.CurrentPower.Value.." | Beast | "..plr.Name) or ("Survivor | "..plr.Name)
            end
            local hi = Instance.new("Highlight",plr.Character)
            hi.FillColor = stats.IsBeast.Value and Color3.new(.9,0,0) or Color3.fromRGB(153,255,153)
            hi.OutlineTransparency = stats.IsBeast.Value and .5 or 1
            hi.FillTransparency = .75
            hi.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
            Elements["Players"][plr] = {
                hi = hi,
                bbg = bbg,
                tl = tl,
                conn = stats.IsBeast:GetPropertyChangedSignal("Value"):Connect(function()
                    if hi then
                        hi.FillColor = stats.IsBeast.Value and Color3.new(.9,0,0) or Color3.fromRGB(153,255,153)
                        hi.OutlineTransparency = stats.IsBeast.Value and .5 or 1
                    end
                    if tl then
                        tl.TextColor3 = stats.IsBeast.Value and Color3.new(.9,0,0) or Color3.fromRGB(153,255,153)
                        tl.Text = stats.IsBeast.Value and ("Power: "..rep.CurrentPower.Value.." | Beast | "..plr.Name) or ("Survivor | "..plr.Name)
                    end
                end)
            }
        end
    end
end
Tabs.Features:Toggle({Title = "Players Esp",Desc = "",Type = "Checkbox",Default = false,Callback = function(state)
    getgenv().Settings.Esp.Players = state
    local Elements = getgenv().Settings.Esp.Elements
    Elements["Players"] = Elements["Players"] or {}
    if state then
        plr_esp(Elements)
        game:GetService("Players").PlayerAdded:Connect(function(plr)
            plr.CharacterAdded:Connect(function()
                repeat task.wait() until plr.Character:FindFirstChild("Humanoid")
                plr_esp(Elements)
            end)
        end)
    else
        for plr,data in pairs(Elements["Players"]) do
            cleanup(plr,Elements)
        end
        Elements["Players"] = {}
    end
end,})
game:GetService("Players").PlayerRemoving:Connect(function(plr)
    local Elements = getgenv().Settings.Esp.Elements
    if Elements and Elements["Players"] then
        cleanup(plr,Elements)
    end
end)
Tabs.Features:Toggle({Title = "Beast Role Extension",Desc = "Make The Players Esp Apply A TextLabel To Identify The Beasts Power And Names",Type = "Checkbox",Value = false,Callback = function(state)
    extension = state
    if getgenv().Settings.Esp.Players then
        local Elements = getgenv().Settings.Esp.Elements
        for plr,data in pairs(Elements["Players"]) do
            cleanup(plr,Elements)
        end
        plr_esp(Elements)
    end
end,})
Tabs.Features:Toggle({Title = "Computers Esp",Desc = "",Type = "Checkbox",Value = false,Callback = function(state)
    getgenv().Settings.Esp.Computers = state
    local Elements = getgenv().Settings.Esp.Elements
    Elements["Computer"] = Elements["Computer"] or {}
    local function Apply(v)
        if v.Name == "ComputerTable" and v.Parent.Name == tostring(rep.CurrentMap.Value) and v.Parent.Parent.Name == "Workspace" and not Elements["Computer"][v] then
            local screen = v:WaitForChild("Screen")
            if not screen then return end
            local hi = Instance.new("Highlight",v)
            hi.FillColor,hi.OutlineTransparency,hi.FillTransparency,hi.DepthMode = screen.Color,1,.75,Enum.HighlightDepthMode.AlwaysOnTop
            screen:GetPropertyChangedSignal("Color"):Connect(function() hi.FillColor = screen.Color end)
            Elements["Computer"][v] = hi
        end
    end
    if getgenv().Settings.Esp.Computers then
        for _,v in ipairs(workspace:GetDescendants()) do
            Apply(v)
        end
        Elements["Computer"].Connection = workspace.DescendantAdded:Connect(function(v)
            Apply(v)
        end)
    else
        if Elements["Computer"].Connection then Elements["Computer"].Connection:Disconnect() Elements["Computer"].Connection = nil end
        for i,v in pairs(Elements["Computer"]) do if typeof(v) == "Instance" then v:Destroy() end end
        Elements["Computer"] = {}
    end
end,})
Tabs.Features:Toggle({Title = "FreezePods Esp",Desc = "",Type = "Checkbox",Value = false,Callback = function(state)
    getgenv().Settings.Esp.Freezers = state
    local Elements = getgenv().Settings.Esp.Elements
    Elements["Freezer"] = Elements["Freezer"] or {}
    local function Apply(v)
        if v.Name == "FreezePod" and not Elements["Freezer"][v] then
            local hi = Instance.new("Highlight",v)
            hi.FillColor,hi.OutlineTransparency,hi.FillTransparency,hi.DepthMode = Color3.fromRGB(153,204,255),1,.75,Enum.HighlightDepthMode.AlwaysOnTop
            Elements["Freezer"][v] = hi
        end
    end
    if getgenv().Settings.Esp.Freezers then
        for _,v in ipairs(workspace:GetDescendants()) do
            Apply(v)
        end
        Elements["Freezer"].Connection = workspace.DescendantAdded:Connect(function(v)
            Apply(v)
        end)
    else
        if Elements["Freezer"].Connection then Elements["Freezer"].Connection:Disconnect() Elements["Freezer"].Connection = nil end
        for i,v in pairs(Elements["Freezer"]) do if typeof(v) == "Instance" then v:Destroy() end end
        Elements["Freezer"] = {}
    end
end,})
Tabs.Features:Toggle({Title = "Vents Esp",Desc = "",Type = "Checkbox",Value = false,Callback = function(state)
    getgenv().Settings.Esp.Vents = state
    local Elements = getgenv().Settings.Esp.Elements
    Elements["Vent"] = Elements["Vent"] or {}
    local function Apply(v)
        if v.Name:match("^Vent") and (v:IsA("Part") or v:IsA("Model")) and not Elements["Vent"][v] then
            local bha = Instance.new("BoxHandleAdornment",v)
            bha.Size,bha.Color3,bha.AlwaysOnTop,bha.Adornee,bha.ZIndex,bha.Transparency = v.Size,Color3.fromRGB(13,105,172),true,v,1,.75
            Elements["Vent"][v] = bha
        end
    end
    if getgenv().Settings.Esp.Vents then
        for _,v in ipairs(workspace:GetDescendants()) do
            Apply(v)
        end
        Elements["Vent"].Connection = workspace.DescendantAdded:Connect(function(v)
            Apply(v)
        end)
    else
        if Elements["Vent"].Connection then Elements["Vent"].Connection:Disconnect() Elements["Vent"].Connection = nil end
        for i,v in pairs(Elements["Vent"]) do if typeof(v) == "Instance" then v:Destroy() end end
        Elements["Vent"] = {}
    end
end,})
